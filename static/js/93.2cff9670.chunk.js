(self.webpackChunkopencv_cam=self.webpackChunkopencv_cam||[]).push([[93],{936:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var n=i(43),o=i(29),s=i.n(o),r=i(738);const d=(0,n.createContext)({});class l extends Set{constructor(e){super(e);const t=[];for(let i of this)t.includes(i.name)?this.delete(i):t.push(i.name)}}const a=new class{constructor(){this.tasks=new l([]),this.fps=60,this.lastFrameTime=performance.now(),this.animationId=null,this.run=e=>{e-this.lastFrameTime>1e3/this.fps&&(this.tasks.forEach((t=>{e-t.lastFrameTime>1e3/t.fps&&(t.task(e),t.lastFrameTime=e)})),this.lastFrameTime=e),this.animationId=requestAnimationFrame(this.run)}}registerTask(e,t){this.tasks.add({task:e,fps:t,name:e.toString(),lastFrameTime:0}),1===this.tasks.size&&(this.animationId=requestAnimationFrame(this.run))}unregisterTask(e){this.tasks.delete(e),0===this.tasks.size&&null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};var u=i(285),h=i.n(u);const c=(e,t)=>{let i=t,n=null;for(let o=0;o<e.size();++o){let s=e.get(o),r=h().contourArea(s);if(r<t){s.delete();continue}let d=h().arcLength(s,!0),l=new(h().Mat);h().approxPolyDP(s,l,.02*d,!0);const a=l&&4===l.rows;r>i&&a?(n&&n.delete(),n=l,i=r):l.delete(),s.delete()}return n},v=e=>{var t,i,n,o,s,r,d,l;if(!e)return null;let a=[];const u=h().minAreaRect(e).center;let c,v,m,x,p=0,w=0,y=0,g=0;for(let h=0;h<e.data32S.length;h+=2){const t={x:e.data32S[h],y:e.data32S[h+1]},i=Math.hypot(t.x-u.x,t.y-u.y);t.x<u.x&&t.y<u.y?i>p&&(c=t,p=i):t.x>u.x&&t.y<u.y?i>w&&(v=t,w=i):t.x<u.x&&t.y>u.y?i>y&&(m=t,y=i):t.x>u.x&&t.y>u.y&&i>g&&(x=t,g=i)}return a.push(new(h().Point)(null===(t=c)||void 0===t?void 0:t.x,null===(i=c)||void 0===i?void 0:i.y)),a.push(new(h().Point)(null===(n=v)||void 0===n?void 0:n.x,null===(o=v)||void 0===o?void 0:o.y)),a.push(new(h().Point)(null===(s=x)||void 0===s?void 0:s.x,null===(r=x)||void 0===r?void 0:r.y)),a.push(new(h().Point)(null===(d=m)||void 0===d?void 0:d.x,null===(l=m)||void 0===l?void 0:l.y)),a},m=(e,t,i)=>((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/Math.sqrt((i.y-t.y)**2+(i.x-t.x)**2),x=(e,t)=>{const i=((e,t)=>{if(!e||!t)return[];let i=[];return i.push(m(e[0],t[0],t[3])),i.push(-m(e[1],t[1],t[2])),i.push(-m(e[2],t[1],t[2])),i.push(m(e[3],t[0],t[3])),i})(e,t);let n=t[1].x-t[0].x;if(i.every((e=>e<0)))return{isValid:!1,action:"zoom out"};if(i.every((e=>e>=0))&&i.some((e=>e/n>.2)))return{isValid:!1,action:"zoom in"};const o=p(t),s=p(e);return s&&o?s.minX<o.minX?{isValid:!1,action:"move left"}:s.maxX>o.maxX?{isValid:!1,action:"move right"}:s.minY<o.minY?{isValid:!1,action:"move up"}:s.maxY>o.maxY?{isValid:!1,action:"move down"}:{isValid:!0}:{isValid:!1}},p=e=>{if(!e)return null;return{minX:Math.min(...e.map((e=>e.x))),maxX:Math.max(...e.map((e=>e.x))),minY:Math.min(...e.map((e=>e.y))),maxY:Math.max(...e.map((e=>e.y)))}};var w=i(579);const y=(0,n.forwardRef)(((e,t)=>{let{debug:i=!1,detectionFrameWidth:o=75,detectionFrameHeight:s=75,videoRef:l}=e;const{docDetected:u,setDocDetected:m}=(0,n.useContext)(d);let p,y,g=[],f=0;const[k,M]=(0,n.useState)("Position document inside boundary"),j=n.useRef(null),R=(0,n.useRef)(null),P=(0,n.useRef)(null),C=n.useRef(null),S=n.useRef(null);(0,n.useImperativeHandle)(t,(()=>({videoStarted:()=>{F(),a.registerTask(b,60),a.registerTask(H,10)}})));const F=()=>{((e,t,i)=>{var n;const o=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.video,s=t.current;s.width=o.videoWidth,s.height=o.videoHeight;const r=i.current;r.style.width=`${o.videoWidth}px`,r.style.height=`${o.videoHeight}px`})(l,R,j),p=R.current?R.current:{width:0,height:0},y=((e,t,i,n)=>{const o=Math.round(i*(e/100)),s=Math.round(n*(t/100)),d=r.Fr?o/2:o/4,l=s/2,a=new(h().Point)(i/2-d,n/2-l),u=new(h().Point)(i/2+d,n/2-l),c=new(h().Point)(i/2-d,n/2+l);return[a,u,new(h().Point)(i/2+d,n/2+l),c]})(o,s,p.width,p.height)},b=()=>{((e,t,i,n,o,s)=>{var r;const d=null===e||void 0===e||null===(r=e.current)||void 0===r?void 0:r.getCanvas();if(d){t.current.getContext("2d",{willReadFrequently:!0}).drawImage(e.current.video,0,0,d.width,d.height);const i=h().imread(t.current);if(s&&4===o.length){const e=[255,0,0,255];h().rectangle(i,o[0],o[2],e,2)}h().imshow(t.current,i),i.delete()}})(l,R,0,0,g,i)},H=()=>{const e=(e=>{const t=e.current.video;t.height=t.videoHeight,t.width=t.videoWidth;const i=new(h().VideoCapture)(t),n=new(h().Mat)(t.height,t.width,h().CV_8UC4);i.read(n),h().cvtColor(n,n,h().COLOR_RGBA2GRAY);let o=Math.max(3,Math.floor(Math.min(n.rows,n.cols)/100));h().GaussianBlur(n,n,new(h().Size)(o,o),0,0);let s=h().mean(n)[0];const r=[.66*s,1.33*s];h().Canny(n,n,r[0],r[1]);let d=h().getStructuringElement(h().MORPH_ELLIPSE,new(h().Size)(5,5));h().morphologyEx(n,n,h().MORPH_CLOSE,d);let l=new(h().MatVector),a=new(h().Mat);h().findContours(n,l,a,h().RETR_EXTERNAL,h().CHAIN_APPROX_SIMPLE);let u=c(l,5e3),m=v(u);return a.delete(),l.delete(),n.delete(),m})(l);if(4===(null===e||void 0===e?void 0:e.length)){g=e;const t=x(g,y);t.isValid?(m(!0),M("capturing")):(m(!1),M(t.action?t.action:"Position document inside boundary"))}else f+=1;f>10&&(f=0,g=[],m(!1),M("Position document inside boundary"))};return(0,w.jsxs)("div",{ref:j,style:{position:"relative"},children:[(0,w.jsx)("canvas",{id:"canvasOutput",ref:R,style:{position:"absolute"}}),(0,w.jsx)("canvas",{id:"canvasDebug",ref:P,style:{position:"absolute"}}),(0,w.jsx)("div",{ref:C,id:"guidance",style:{position:"absolute",color:"white",textAlign:"center",bottom:"40px",width:"100%"},children:k}),(0,w.jsx)("div",{ref:S,role:"alert",style:{clipPath:"inset(50%)",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:"1px"},children:k})]})})),g=e=>{const[t,i]=(0,n.useState)(!1);let o={};e&&e.autoCapture&&(o=e.autoCapture);const l=n.useRef(null),a=n.useRef(null),u=(0,n.useRef)(null),[h,c]=(0,n.useState)(0),[v,m]=(0,n.useState)(0),[x,p]=(0,n.useState)(0),[g,f]=(0,n.useState)(0),k=(()=>{let e={facingMode:"user",width:{ideal:1280},height:{ideal:720}};return r.Fr&&(e={facingMode:"environment",width:{ideal:window.innerHeight},height:{ideal:window.screen.width}}),e})();return(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:{position:"relative"},children:[(0,w.jsx)("div",{ref:l,children:(0,w.jsx)(s(),{videoConstraints:k,ref:a,style:{position:"absolute"},onUserMedia:()=>{setTimeout((()=>{var t,i,n,o,s,d,l,h;u.current&&(c(null!==(t=a.current)&&void 0!==t&&null!==(i=t.video)&&void 0!==i&&i.videoWidth?null===(n=a.current)||void 0===n||null===(o=n.video)||void 0===o?void 0:o.videoWidth:0),m(null!==(s=a.current)&&void 0!==s&&null!==(d=s.video)&&void 0!==d&&d.videoHeight?null===(l=a.current)||void 0===l||null===(h=l.video)||void 0===h?void 0:h.videoHeight:0),(()=>{var t,i,n,o,s,d,l,u;const h=null!==(t=a.current)&&void 0!==t&&null!==(i=t.video)&&void 0!==i&&i.videoWidth?null===(n=a.current)||void 0===n||null===(o=n.video)||void 0===o?void 0:o.videoWidth:0,c=null!==(s=a.current)&&void 0!==s&&null!==(d=s.video)&&void 0!==d&&d.videoHeight?null===(l=a.current)||void 0===l||null===(u=l.video)||void 0===u?void 0:u.videoHeight:0,v=r.Fr?1:2;p(Math.round(h*(e.autoCapture.detectionFrameWidth/100))/v),f(Math.round(c*(e.autoCapture.detectionFrameHeight/100)))})(),u.current.videoStarted())}),2e3)}})}),(0,w.jsx)("div",{style:{position:"absolute",zIndex:2,width:h,height:v},children:x&&g?(0,w.jsxs)("svg",{width:h,height:v,xmlns:"http://www.w3.org/2000/svg",children:[(0,w.jsx)("defs",{children:(0,w.jsxs)("mask",{id:"mask1",children:[(0,w.jsx)("rect",{mask:"url(#mask1)",width:h,height:v,x:"0",y:"0",style:{fill:"white",stroke:"none",strokeWidth:5,opacity:.5}}),(0,w.jsx)("rect",{width:x,height:g,x:h/2-x/2,y:v/2-g/2,rx:"20",ry:"20"})]})}),(0,w.jsx)("rect",{mask:"url(#mask1)",width:h,height:v,x:"0",y:"0",style:{fill:"white",stroke:"none",strokeWidth:5,opacity:.5}}),(0,w.jsx)("rect",{width:x,height:g,x:h/2-x/2,y:v/2-g/2,rx:"20",ry:"20",style:{fill:"none",stroke:t?"green":"black",strokeWidth:5,opacity:1}})]}):null}),(0,w.jsx)("div",{style:{position:"absolute",zIndex:1},children:(0,w.jsx)(d.Provider,{value:{docDetected:t,setDocDetected:i},children:(0,w.jsx)(y,{...o,ref:u,videoRef:a})})})]}),(0,w.jsx)("div",{style:{position:"relative",zIndex:3},children:(0,w.jsx)("a",{href:"/camster",children:"Back to settings"})})]})}},392:()=>{},562:()=>{},90:()=>{}}]);
//# sourceMappingURL=93.2cff9670.chunk.js.map