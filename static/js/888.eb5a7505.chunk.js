(self.webpackChunkopencv_cam=self.webpackChunkopencv_cam||[]).push([[888],{129:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S});var i=n(43),o=n(29),r=n.n(o),a=n(944);class s extends Set{constructor(e){super(e);const t=[];for(let n of this)t.includes(n.name)?this.delete(n):t.push(n.name)}}const l=new class{constructor(){this.tasks=new s([]),this.fps=60,this.lastFrameTime=performance.now(),this.animationId=null,this.run=e=>{e-this.lastFrameTime>1e3/this.fps&&(this.tasks.forEach((t=>{e-t.lastFrameTime>1e3/t.fps&&(t.task(e),t.lastFrameTime=e)})),this.lastFrameTime=e),this.animationId=requestAnimationFrame(this.run)}}registerTask(e,t){this.tasks.add({task:e,fps:t,name:e.toString(),lastFrameTime:0}),1===this.tasks.size&&(this.animationId=requestAnimationFrame(this.run))}unregisterTask(e){this.tasks.delete(e),0===this.tasks.size&&null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};var u=n(738),d=n(285),c=n.n(d);const h=(e,t)=>{let n=new(c().MatVector),i=c().matFromArray(t.length,1,c().CV_32SC2,t.flatMap((e=>[e.x,e.y])));n.push_back(i);const o=new(c().Scalar)(255,0,0,255);c().polylines(e,n,!0,o,2),i.delete(),n.delete()},m=e=>e&&4===e.rows,v=(e,t)=>{let n=1e3,i=null;for(let o=0;o<e.size();++o){let r=e.get(o),a=c().contourArea(r);if(a<t){r.delete();continue}let s=c().arcLength(r,!0),l=new(c().Mat);c().approxPolyDP(r,l,.02*s,!0),a>n&&m(l)?(i&&i.delete(),i=l,n=a):l.delete(),r.delete()}return i},x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;c().cvtColor(e,t,c().COLOR_RGB2GRAY);let n=Math.max(3,Math.floor(Math.min(e.rows,e.cols)/100));c().GaussianBlur(e,t,new(c().Size)(n,n),0,0);let i=p(e);c().Canny(e,t,i[0],i[1]);let o=c().getStructuringElement(c().MORPH_ELLIPSE,new(c().Size)(5,5));c().morphologyEx(e,t,c().MORPH_CLOSE,o)},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.66,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1.33,i=c().mean(e)[0];return[t*i,n*i]},g=e=>{var t,n,i,o,r,a,s,l;if(!e)return null;let u=[];const d=c().minAreaRect(e).center;let h,m,v,x,p=0,g=0,y=0,f=0;for(let c=0;c<e.data32S.length;c+=2){const t={x:e.data32S[c],y:e.data32S[c+1]},n=Math.hypot(t.x-d.x,t.y-d.y);t.x<d.x&&t.y<d.y?n>p&&(h=t,p=n):t.x>d.x&&t.y<d.y?n>g&&(m=t,g=n):t.x<d.x&&t.y>d.y?n>y&&(v=t,y=n):t.x>d.x&&t.y>d.y&&n>f&&(x=t,f=n)}return u.push(new(c().Point)(null===(t=h)||void 0===t?void 0:t.x,null===(n=h)||void 0===n?void 0:n.y)),u.push(new(c().Point)(null===(i=m)||void 0===i?void 0:i.x,null===(o=m)||void 0===o?void 0:o.y)),u.push(new(c().Point)(null===(r=x)||void 0===r?void 0:r.x,null===(a=x)||void 0===a?void 0:a.y)),u.push(new(c().Point)(null===(s=v)||void 0===s?void 0:s.x,null===(l=v)||void 0===l?void 0:l.y)),u},y=(e,t,n)=>{const i=Math.round(t*(e.documentWidth/100)),o=Math.round(n*(e.documentHeight/100)),r=u.Fr?i/2:i/4,a=o/2,s=new(c().Point)(t/2-r,n/2-a),l=new(c().Point)(t/2+r,n/2-a),d=new(c().Point)(t/2-r,n/2+a);return[s,l,new(c().Point)(t/2+r,n/2+a),d]},f=(e,t)=>{c().rectangle(e,t[0],t[2],[255,255,255,255],2)};let w=6;const M=(e,t,n,i)=>{let o=t[1].x-t[0].x;if(e.every((e=>e<0)))return i.innerText="Zoom out.",!1;if(e.every((e=>e>=0))){if(e.some((e=>e/o>n/100)))return i.innerText="Zoom in.",!1;i.innerText=""}return!0},T=(e,t)=>{let n=[];return n.push(C(e[0],t[0],t[3])),n.push(-C(e[1],t[1],t[2])),n.push(-C(e[2],t[1],t[2])),n.push(C(e[3],t[0],t[3])),n},C=(e,t,n)=>((n.y-t.y)*e.x-(n.x-t.x)*e.y+n.x*t.y-n.y*t.x)/Math.sqrt((n.y-t.y)**2+(n.x-t.x)**2),P=(e,t,n)=>{let i=.5*e;return t<i&&(n.innerText="Zoom in.",console.log("Zoom in.")),t>e&&(n.innerText="Zoom out",console.log("Zoom out")),i<=t&&t<=e&&(n.innerText="Area in range.",console.log("Area in range."),!0)},A=(e,t,n)=>{const i=k(e),o=k(t);return o.minX<i.minX?(n.innerText="Move left",console.log("Move left"),!1):o.maxX>i.maxX?(n.innerText="Move right",console.log("Move right"),!1):o.minY<i.minY?(n.innerText="Move up",console.log("Move up"),!1):!(o.maxY>i.maxY)||(n.innerText="Move down",console.log("Move down"),!1)},k=e=>({minX:Math.min(...e.map((e=>e.x))),maxX:Math.max(...e.map((e=>e.x))),minY:Math.min(...e.map((e=>e.y))),maxY:Math.max(...e.map((e=>e.y)))});var R=n(579);const S=e=>{const[t,n]=(0,a.SF)(),o=i.useRef(null),s=i.useRef(null),d=i.useRef(null),m=(0,i.useRef)(null),p=i.useRef(null),C=i.useRef(null),k=(()=>{let e={facingMode:{exact:"user"},width:{ideal:1280},height:{ideal:720}};return u.Fr&&(e={facingMode:{exact:"environment"},width:{ideal:window.innerHeight},height:{ideal:window.screen.width}}),e})(),S=()=>{((e,t,n,i,o)=>{var r;const a=null===e||void 0===e||null===(r=e.current)||void 0===r?void 0:r.video,s=t.current;s.width=a.videoWidth,s.height=a.videoHeight;const l=n.current;l.style.width=`${a.videoWidth}px`,l.style.height=`${a.videoHeight}px`,o(y(i,s.width,s.height))})(d,m,s,e,V)},F=()=>{((e,t,n,i,o)=>{var r;const a=null===e||void 0===e||null===(r=e.current)||void 0===r?void 0:r.getCanvas();if(a){t.current.getContext("2d",{willReadFrequently:!0}).drawImage(e.current.video,0,0,a.width,a.height);const r=c().imread(t.current);f(r,i),o&&n.debug&&h(r,o),c().imshow(t.current,r),r.delete()}})(d,m,e,t.autoCapture.guidancePoints,t.autoCapture.lastDetectedPoints)},b=()=>{((e,t,n,i)=>{var o;const r=null===e||void 0===e||null===(o=e.current)||void 0===o?void 0:o.video;r.height=r.videoHeight,r.width=r.videoWidth;const a=new(c().VideoCapture)(r),s=new(c().Mat)(r.height,r.width,c().CV_8UC4);a.read(s),x(s);let l=new(c().MatVector),u=new(c().Mat);c().findContours(s,l,u,c().RETR_EXTERNAL,c().CHAIN_APPROX_SIMPLE);const d=r.height/2*r.width/8;let h=v(l,d);i(g(h)),s.delete(),u.delete(),l.delete()})(d,0,0,E)},_=()=>{((e,t,n,i,o,r,a,s,l)=>{const u=a.current;if(!t)return;const d=c().matFromArray(e.length,1,c().CV_32SC2,e.flatMap((e=>[e.x,e.y]))),h=c().matFromArray(t.length,1,c().CV_32SC2,t.flatMap((e=>[e.x,e.y])));if("area"===s){const e=c().contourArea(d),t=c().contourArea(h);if(o(P(e,t,u)),!n)return void(w=6)}else if("edges"===s){let i=T(t,e);if(o(M(i,e,l,u)),!n)return void(w=6)}r(A(e,t,u)),i?(n&&i&&(u.innerText="Document ready to be captured.",console.log("Document ready to be captured."),console.log(w),w--),0===w&&(u.innerText="CAPTURE",console.log("CAPTURE"),w=6),d.delete(),h.delete()):w=6})(t.autoCapture.guidancePoints,t.autoCapture.lastDetectedPoints,t.autoCapture.isAreaValid,t.autoCapture.isPositionValid,j,I,p,e.capturingType,e.capturingMargin)},E=e=>{const i=t;i.autoCapture.lastDetectedPoints=e,n(i)},V=e=>{const i=t;i.autoCapture.guidancePoints=e,n(i)},j=e=>{const i=t;i.autoCapture.isAreaValid=e,n(i)},I=e=>{const i=t;i.autoCapture.isPositionValid=e,n(i)},H=()=>{var e,t;const n=null===(e=p.current)||void 0===e?void 0:e.innerText;(null===(t=C.current)||void 0===t?void 0:t.innerText)!==n&&C.current&&p.current&&(C.current&&n?C.current.innerText=n:C.current.innerText="")};return(0,R.jsxs)("div",{children:[(0,R.jsxs)("div",{style:{position:"relative"},children:[(0,R.jsx)("div",{ref:o,children:(0,R.jsx)(r(),{videoConstraints:k,ref:d,onUserMedia:()=>{setTimeout((()=>{S(),l.registerTask(F,60),l.registerTask(b,10),l.registerTask(_,2),l.registerTask(H,10)}),2e3)},style:{position:"absolute"}})}),(0,R.jsxs)("div",{ref:s,style:{position:"relative"},children:[(0,R.jsx)("canvas",{id:"canvasOutput",ref:m,style:{position:"absolute"}}),(0,R.jsx)("div",{ref:p,id:"guidance",style:{position:"absolute",color:"white",textAlign:"center",bottom:"40px",width:"100%"},children:"Position document inside boundary"}),(0,R.jsx)("div",{ref:C,role:"alert",style:{clipPath:"inset(50%)",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:"1px"},children:"Position document inside boundary"})]})]}),(0,R.jsx)("div",{style:{position:"relative"},children:(0,R.jsx)("a",{href:"/camster",children:"Back to settings"})})]})}},392:()=>{},562:()=>{},90:()=>{}}]);
//# sourceMappingURL=888.eb5a7505.chunk.js.map