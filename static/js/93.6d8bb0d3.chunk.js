(self.webpackChunkopencv_cam=self.webpackChunkopencv_cam||[]).push([[93],{936:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var n=i(43),o=i(29),s=i.n(o),r=i(738);const l=(0,n.createContext)({});var d=i(285),a=i.n(d);const u=(e,t)=>{let i=t,n=null;for(let o=0;o<e.size();++o){let s=e.get(o),r=a().contourArea(s);if(r<t){s.delete();continue}let l=a().arcLength(s,!0),d=new(a().Mat);a().approxPolyDP(s,d,.02*l,!0);const u=d&&4===d.rows;r>i&&u?(n&&n.delete(),n=d,i=r):d.delete(),s.delete()}return n},h=e=>{var t,i,n,o,s,r,l,d;if(!e)return null;let u=[];const h=a().minAreaRect(e).center;let c,v,m,x,p=0,y=0,w=0,f=0;for(let a=0;a<e.data32S.length;a+=2){const t={x:e.data32S[a],y:e.data32S[a+1]},i=Math.hypot(t.x-h.x,t.y-h.y);t.x<h.x&&t.y<h.y?i>p&&(c=t,p=i):t.x>h.x&&t.y<h.y?i>y&&(v=t,y=i):t.x<h.x&&t.y>h.y?i>w&&(m=t,w=i):t.x>h.x&&t.y>h.y&&i>f&&(x=t,f=i)}return u.push(new(a().Point)(null===(t=c)||void 0===t?void 0:t.x,null===(i=c)||void 0===i?void 0:i.y)),u.push(new(a().Point)(null===(n=v)||void 0===n?void 0:n.x,null===(o=v)||void 0===o?void 0:o.y)),u.push(new(a().Point)(null===(s=x)||void 0===s?void 0:s.x,null===(r=x)||void 0===r?void 0:r.y)),u.push(new(a().Point)(null===(l=m)||void 0===l?void 0:l.x,null===(d=m)||void 0===d?void 0:d.y)),u},c=(e,t,i)=>((i.y-t.y)*e.x-(i.x-t.x)*e.y+i.x*t.y-i.y*t.x)/Math.sqrt((i.y-t.y)**2+(i.x-t.x)**2),v=(e,t)=>{const i=((e,t)=>{if(!e||!t)return[];let i=[];return i.push(c(e[0],t[0],t[3])),i.push(-c(e[1],t[1],t[2])),i.push(-c(e[2],t[1],t[2])),i.push(c(e[3],t[0],t[3])),i})(e,t);let n=t[1].x-t[0].x;if(i.every((e=>e<0)))return{isValid:!1,action:"zoom out"};if(i.every((e=>e>=0))&&i.some((e=>e/n>.2)))return{isValid:!1,action:"zoom in"};const o=m(t),s=m(e);return s&&o?s.minX<o.minX?{isValid:!1,action:"move left"}:s.maxX>o.maxX?{isValid:!1,action:"move right"}:s.minY<o.minY?{isValid:!1,action:"move up"}:s.maxY>o.maxY?{isValid:!1,action:"move down"}:{isValid:!0}:{isValid:!1}},m=e=>{if(!e)return null;return{minX:Math.min(...e.map((e=>e.x))),maxX:Math.max(...e.map((e=>e.x))),minY:Math.min(...e.map((e=>e.y))),maxY:Math.max(...e.map((e=>e.y)))}};class x extends Set{constructor(e){super(e);const t=[];for(let i of this)t.includes(i.name)?this.delete(i):t.push(i.name)}}const p=new class{constructor(){this.tasks=new x([]),this.fps=60,this.lastFrameTime=performance.now(),this.animationId=null,this.run=e=>{e-this.lastFrameTime>1e3/this.fps&&(this.tasks.forEach((t=>{e-t.lastFrameTime>1e3/t.fps&&(t.task(e),t.lastFrameTime=e)})),this.lastFrameTime=e),this.animationId=requestAnimationFrame(this.run)}}registerTask(e,t){this.tasks.add({task:e,fps:t,name:e.toString(),lastFrameTime:0}),1===this.tasks.size&&(this.animationId=requestAnimationFrame(this.run))}unregisterTask(e){this.tasks.delete(e),0===this.tasks.size&&null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};var y=i(579);const w=(0,n.forwardRef)(((e,t)=>{let{debug:i=!1,detectionFrameWidth:o=75,detectionFrameHeight:s=75,videoRef:d}=e;const{docDetected:c,setDocDetected:m}=(0,n.useContext)(l);let x,w,f=[],g=0;const[k,j]=(0,n.useState)("Position document inside boundary"),M=n.useRef(null),R=(0,n.useRef)(null),P=(0,n.useRef)(null),S=n.useRef(null),C=n.useRef(null);(0,n.useImperativeHandle)(t,(()=>({videoStarted:()=>{F(),p.registerTask(b,60),p.registerTask(I,10)}})));const F=()=>{((e,t,i)=>{var n;const o=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.video,s=t.current;s.width=o.videoWidth,s.height=o.videoHeight;const r=i.current;r.style.width=`${o.videoWidth}px`,r.style.height=`${o.videoHeight}px`})(d,R,M),x=R.current?R.current:{width:0,height:0},w=((e,t,i,n)=>{const o=Math.round(i*(e/100)),s=Math.round(n*(t/100)),l=r.Fr?o/2:o/4,d=s/2,u=new(a().Point)(i/2-l,n/2-d),h=new(a().Point)(i/2+l,n/2-d),c=new(a().Point)(i/2-l,n/2+d);return[u,h,new(a().Point)(i/2+l,n/2+d),c]})(o,s,x.width,x.height)},b=()=>{((e,t,i,n,o,s)=>{var r;const l=null===e||void 0===e||null===(r=e.current)||void 0===r?void 0:r.getCanvas();if(l){t.current.getContext("2d",{willReadFrequently:!0}).drawImage(e.current.video,0,0,l.width,l.height);const i=a().imread(t.current);if(s&&4===o.length){const e=[255,0,0,255];a().rectangle(i,o[0],o[2],e,2)}a().imshow(t.current,i),i.delete()}})(d,R,0,0,f,i)},I=()=>{const e=(e=>{let t=a().imread(e.current);a().cvtColor(t,t,a().COLOR_RGBA2GRAY);let i=Math.max(3,Math.floor(Math.min(t.rows,t.cols)/100));a().GaussianBlur(t,t,new(a().Size)(i,i),0,0);let n=a().mean(t)[0];const o=[.66*n,1.33*n];a().Canny(t,t,o[0],o[1]);let s=a().getStructuringElement(a().MORPH_ELLIPSE,new(a().Size)(5,5));a().morphologyEx(t,t,a().MORPH_CLOSE,s);let r=new(a().MatVector),l=new(a().Mat);a().findContours(t,r,l,a().RETR_EXTERNAL,a().CHAIN_APPROX_SIMPLE);let d=u(r,5e3),c=h(d);return l.delete(),r.delete(),t.delete(),c})(R);if(4===(null===e||void 0===e?void 0:e.length)){f=e;const t=v(f,w);t.isValid?(m(!0),j("capturing")):(m(!1),j(t.action?t.action:"Position document inside boundary"))}else g+=1;g>10&&(g=0,f=[],m(!1),j("Position document inside boundary"))};return(0,y.jsxs)("div",{ref:M,style:{position:"relative"},children:[(0,y.jsx)("canvas",{id:"canvasOutput",ref:R,style:{position:"absolute"}}),(0,y.jsx)("canvas",{id:"canvasDebug",ref:P,style:{position:"absolute"}}),(0,y.jsx)("div",{ref:S,id:"guidance",style:{position:"absolute",color:"white",textAlign:"center",bottom:"40px",width:"100%"},children:k}),(0,y.jsx)("div",{ref:C,role:"alert",style:{clipPath:"inset(50%)",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:"1px"},children:k})]})})),f=e=>{const[t,i]=(0,n.useState)(!1);let o={};e&&e.autoCapture&&(o=e.autoCapture);const d=n.useRef(null),a=n.useRef(null),u=(0,n.useRef)(null),[h,c]=(0,n.useState)(0),[v,m]=(0,n.useState)(0),[x,p]=(0,n.useState)(0),[f,g]=(0,n.useState)(0),k=(()=>{let e={facingMode:"user",width:{ideal:1280},height:{ideal:720}};return r.Fr&&(e={facingMode:"environment",width:{ideal:window.innerHeight},height:{ideal:window.screen.width}}),e})();return(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{style:{position:"relative"},children:[(0,y.jsx)("div",{ref:d,children:(0,y.jsx)(s(),{videoConstraints:k,ref:a,style:{position:"absolute"},onUserMedia:()=>{setTimeout((()=>{var t,i,n,o,s,l,d,h;u.current&&(c(null!==(t=a.current)&&void 0!==t&&null!==(i=t.video)&&void 0!==i&&i.videoWidth?null===(n=a.current)||void 0===n||null===(o=n.video)||void 0===o?void 0:o.videoWidth:0),m(null!==(s=a.current)&&void 0!==s&&null!==(l=s.video)&&void 0!==l&&l.videoHeight?null===(d=a.current)||void 0===d||null===(h=d.video)||void 0===h?void 0:h.videoHeight:0),(()=>{var t,i,n,o,s,l,d,u;const h=null!==(t=a.current)&&void 0!==t&&null!==(i=t.video)&&void 0!==i&&i.videoWidth?null===(n=a.current)||void 0===n||null===(o=n.video)||void 0===o?void 0:o.videoWidth:0,c=null!==(s=a.current)&&void 0!==s&&null!==(l=s.video)&&void 0!==l&&l.videoHeight?null===(d=a.current)||void 0===d||null===(u=d.video)||void 0===u?void 0:u.videoHeight:0,v=r.Fr?1:2;p(Math.round(h*(e.autoCapture.detectionFrameWidth/100))/v),g(Math.round(c*(e.autoCapture.detectionFrameHeight/100)))})(),u.current.videoStarted())}),2e3)}})}),(0,y.jsx)("div",{style:{position:"absolute",zIndex:2,width:h,height:v},children:x&&f?(0,y.jsxs)("svg",{width:h,height:v,xmlns:"http://www.w3.org/2000/svg",children:[(0,y.jsx)("defs",{children:(0,y.jsxs)("mask",{id:"mask1",children:[(0,y.jsx)("rect",{mask:"url(#mask1)",width:h,height:v,x:"0",y:"0",style:{fill:"white",stroke:"none",strokeWidth:5,opacity:.5}}),(0,y.jsx)("rect",{width:x,height:f,x:h/2-x/2,y:v/2-f/2,rx:"20",ry:"20"})]})}),(0,y.jsx)("rect",{mask:"url(#mask1)",width:h,height:v,x:"0",y:"0",style:{fill:"white",stroke:"none",strokeWidth:5,opacity:.5}}),(0,y.jsx)("rect",{width:x,height:f,x:h/2-x/2,y:v/2-f/2,rx:"20",ry:"20",style:{fill:"none",stroke:t?"green":"black",strokeWidth:5,opacity:1}})]}):null}),(0,y.jsx)("div",{style:{position:"absolute",zIndex:1},children:(0,y.jsx)(l.Provider,{value:{docDetected:t,setDocDetected:i},children:(0,y.jsx)(w,{...o,ref:u,videoRef:a})})})]}),(0,y.jsx)("div",{style:{position:"relative",zIndex:3},children:(0,y.jsx)("a",{href:"/camster",children:"Back to settings"})})]})}},392:()=>{},562:()=>{},90:()=>{}}]);
//# sourceMappingURL=93.6d8bb0d3.chunk.js.map